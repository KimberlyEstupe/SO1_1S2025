FROM golang:1.21 as builder

WORKDIR /app

COPY rabbitmq-consumer/ .

RUN go mod init rabbitmq-consumer && \
    go get github.com/rabbitmq/amqp091-go && \
    go get github.com/go-redis/redis/v8 && \
    go build -o /app/consumer

# Final stage
FROM debian:bookworm-slim

WORKDIR /app

# Install ca-certificates for HTTPS
RUN apt-get update && apt-get install -y ca-certificates && rm -rf /var/lib/apt/lists/*

COPY --from=builder /app/consumer /app/consumer

CMD ["/app/consumer"]